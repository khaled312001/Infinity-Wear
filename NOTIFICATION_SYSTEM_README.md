# نظام الإشعارات - Infinity Wear

## نظرة عامة
تم تطوير نظام إشعارات شامل ومتكامل لإدارة جميع الإشعارات في لوحة التحكم الإدارية. النظام يتتبع الطلبات الجديدة، رسائل الاتصال، رسائل الواتساب، وطلبات المستوردين.

## الميزات الرئيسية

### 1. أنواع الإشعارات المدعومة
- **طلبات العملاء**: إشعارات عند استلام طلبات جديدة
- **رسائل الاتصال**: إشعارات عند وصول رسائل من نموذج الاتصال
- **رسائل الواتساب**: إشعارات عند استقبال رسائل واتساب جديدة
- **طلبات المستوردين**: إشعارات عند تسجيل طلبات من المستوردين

### 2. واجهة المستخدم
- **شريط الإشعارات**: عرض عدد الإشعارات غير المقروءة
- **قائمة الإشعارات**: عرض الإشعارات الأخيرة مع إمكانية التفاعل
- **صفحة الإشعارات**: صفحة مخصصة لعرض وإدارة جميع الإشعارات
- **فلترة وترتيب**: إمكانية فلترة الإشعارات حسب النوع والحالة

### 3. الميزات التقنية
- **تحديث فوري**: تحديث الإشعارات كل 30 ثانية
- **AJAX**: تحميل الإشعارات دون إعادة تحميل الصفحة
- **أرشفة**: إمكانية أرشفة الإشعارات المقروءة
- **تنظيف تلقائي**: حذف الإشعارات المؤرشفة القديمة

## الملفات المضافة/المحدثة

### 1. قاعدة البيانات
- **جدول الإشعارات**: `notifications` table
- **الهجرة**: `2025_10_04_145549_create_notifications_table.php`

### 2. النماذج
- **Notification Model**: `app/Models/Notification.php`
- **NotificationService**: `app/Services/NotificationService.php`

### 3. الكونترولرات
- **NotificationController**: `app/Http/Controllers/Admin/NotificationController.php`
- **تحديث OrderController**: إضافة إشعارات للطلبات الجديدة
- **تحديث ContactController**: إضافة إشعارات لرسائل الاتصال
- **تحديث WhatsAppController**: إضافة إشعارات لرسائل الواتساب
- **تحديث ImporterController**: إضافة إشعارات لطلبات المستوردين

### 4. الواجهات
- **تحديث dashboard.blade.php**: إضافة نظام الإشعارات الفوري
- **صفحة الإشعارات**: `resources/views/admin/notifications/index.blade.php`
- **تحديث الشريط الجانبي**: إضافة رابط الإشعارات

### 5. المسارات
- **مسارات الإشعارات**: إضافة في `routes/web.php`

### 6. الأوامر
- **إنشاء إشعارات تجريبية**: `app/Console/Commands/CreateTestNotifications.php`
- **تنظيف الإشعارات**: `app/Console/Commands/CleanupOldNotifications.php`

## كيفية الاستخدام

### 1. إنشاء إشعارات تجريبية
```bash
php artisan notifications:create-test
```

### 2. تنظيف الإشعارات القديمة
```bash
php artisan notifications:cleanup --days=30
```

### 3. جدولة التنظيف التلقائي
تم إعداد تنظيف تلقائي يومي للإشعارات المؤرشفة الأقدم من 30 يوم.

## API Endpoints

### 1. الحصول على الإشعارات غير المقروءة
```
GET /admin/notifications/unread
```

### 2. الحصول على إحصائيات الإشعارات
```
GET /admin/notifications/stats
```

### 3. تحديد إشعار كمقروء
```
POST /admin/notifications/mark-read
```

### 4. تحديد جميع الإشعارات كمقروءة
```
POST /admin/notifications/mark-all-read
```

### 5. أرشفة إشعار
```
POST /admin/notifications/archive
```

## التخصيص

### 1. إضافة نوع إشعار جديد
1. أضف النوع الجديد في جدول الإشعارات
2. أضف دالة إنشاء الإشعار في `NotificationService`
3. أضف المنطق في الكونترولر المناسب
4. حدث واجهة المستخدم لعرض النوع الجديد

### 2. تخصيص التصميم
- يمكن تخصيص الألوان والأيقونات في CSS
- يمكن تعديل تخطيط الإشعارات في `notification-dropdown`
- يمكن إضافة تأثيرات بصرية جديدة

### 3. إعدادات التحديث
- يمكن تغيير فترة التحديث من 30 ثانية إلى قيمة أخرى
- يمكن إضافة تحديث فوري باستخدام WebSockets
- يمكن إضافة إشعارات صوتية

## الأمان
- جميع الطلبات محمية بـ CSRF token
- التحقق من صحة البيانات المدخلة
- حماية من SQL injection باستخدام Eloquent ORM

## الأداء
- استخدام فهارس قاعدة البيانات للبحث السريع
- تحميل الإشعارات بـ AJAX لتجنب إعادة تحميل الصفحة
- تنظيف تلقائي للإشعارات القديمة

## الدعم والصيانة
- النظام مصمم ليكون قابل للتوسع
- كود منظم ومعلق باللغة العربية
- سهولة إضافة ميزات جديدة
- توثيق شامل للوظائف

## ملاحظات مهمة
1. تأكد من تشغيل الجدولة (Scheduler) للتنظيف التلقائي
2. راقب حجم قاعدة البيانات وضبط فترة التنظيف حسب الحاجة
3. يمكن إضافة إشعارات بالبريد الإلكتروني مستقبلاً
4. النظام يدعم الإشعارات الفورية عند إضافة WebSockets
