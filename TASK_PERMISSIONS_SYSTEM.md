# نظام صلاحيات المهام

## نظرة عامة

تم تطوير نظام شامل لإدارة صلاحيات المهام في النظام، حيث يمكن للأدمن تعديل جميع تفاصيل المهام، بينما يمكن لفريق التسويق والمبيعات نقل المهام فقط.

## الميزات الرئيسية

### 1. صلاحيات الأدمن
- **تعديل كامل**: يمكن للأدمن تعديل جميع تفاصيل المهام
- **حذف المهام**: يمكن للأدمن حذف المهام
- **إنشاء المهام**: يمكن للأدمن إنشاء مهام جديدة
- **نقل المهام**: يمكن للأدمن نقل المهام بين الأعمدة

### 2. صلاحيات فريق التسويق
- **عرض المهام**: يمكن لفريق التسويق عرض المهام المخصصة له
- **نقل المهام**: يمكن لفريق التسويق نقل المهام بين الأعمدة فقط
- **إضافة تعليقات**: يمكن لفريق التسويق إضافة تعليقات على المهام
- **لا يمكن التعديل أو الحذف**: لا يمكن لفريق التسويق تعديل أو حذف المهام

### 3. صلاحيات فريق المبيعات
- **عرض المهام**: يمكن لفريق المبيعات عرض المهام المخصصة له
- **نقل المهام**: يمكن لفريق المبيعات نقل المهام بين الأعمدة فقط
- **إضافة تعليقات**: يمكن لفريق المبيعات إضافة تعليقات على المهام
- **لا يمكن التعديل أو الحذف**: لا يمكن لفريق المبيعات تعديل أو حذف المهام

## الملفات المحدثة

### 1. قاعدة البيانات
- `database/seeders/DashboardPermissionsSeeder.php` - إضافة صلاحيات جديدة للمهام

### 2. الكنترولرات
- `app/Http/Controllers/Admin/TaskManagementController.php` - كنترولر إدارة المهام للأدمن
- `app/Http/Controllers/Marketing/TaskController.php` - كنترولر المهام لفريق التسويق
- `app/Http/Controllers/Sales/TaskController.php` - كنترولر المهام لفريق المبيعات

### 3. الواجهات
- `resources/views/admin/tasks/index.blade.php` - صفحة إدارة المهام مع مودال التعديل المحدث
- `public/css/task-edit-modal.css` - تنسيقات مودال التعديل
- `public/js/task-management.js` - JavaScript محدث لدعم المودال الجديد

### 4. الروتات
- `routes/web.php` - إضافة روات جديدة لفريق التسويق والمبيعات

## الصلاحيات المضافة

### صلاحيات الأدمن
- `tasks.edit` - تعديل المهام
- `tasks.delete` - حذف المهام
- `tasks.create` - إنشاء المهام

### صلاحيات فريق التسويق
- `marketing.tasks` - عرض المهام
- `marketing.tasks.move` - نقل المهام

### صلاحيات فريق المبيعات
- `sales.tasks` - عرض المهام
- `sales.tasks.move` - نقل المهام

## مودال التعديل الجديد

### الحقول المتاحة
- **معلومات أساسية**: العنوان، الوصف، الأولوية، الحالة
- **التعيين**: اللوحة، العمود، المستخدم المكلف، تاريخ الاستحقاق
- **التفاصيل**: الساعات المتوقعة، اللون، نسبة الإنجاز
- **التصنيف**: العلامات، الوسوم، حالة العجلة
- **المحتوى**: التعليقات، المرفقات، القائمة المرجعية

### الميزات التفاعلية
- إضافة وإزالة العلامات والوسوم
- إضافة تعليقات جديدة
- رفع مرفقات متعددة
- إدارة القائمة المرجعية
- حفظ التغييرات تلقائياً

## نظام الإشعارات

### الإشعارات التلقائية
- عند تعيين مهمة جديدة
- عند تحديث المهمة
- عند نقل المهمة
- عند إضافة تعليق

### أنواع الإشعارات
- إشعارات قاعدة البيانات
- إشعارات فورية (قابلة للتطوير)

## الاستخدام

### للأدمن
1. انتقل إلى `/admin/tasks`
2. اضغط على زر "تعديل" في أي مهمة
3. قم بتعديل الحقول المطلوبة
4. اضغط "حفظ التغييرات"

### لفريق التسويق
1. انتقل إلى `/marketing/tasks`
2. اضغط على مهمة لعرضها
3. اسحب المهمة لنقلها بين الأعمدة
4. أضف تعليقات حسب الحاجة

### لفريق المبيعات
1. انتقل إلى `/sales/tasks`
2. اضغط على مهمة لعرضها
3. اسحب المهمة لنقلها بين الأعمدة
4. أضف تعليقات حسب الحاجة

## التطوير المستقبلي

### ميزات مقترحة
- إشعارات فورية باستخدام WebSocket
- تقارير مفصلة عن المهام
- نظام تتبع الوقت
- تكامل مع التقويم
- إشعارات البريد الإلكتروني

### تحسينات الأداء
- تحميل المهام بشكل تدريجي
- تخزين مؤقت للبيانات
- تحسين استعلامات قاعدة البيانات

## الأمان

### التحقق من الصلاحيات
- التحقق من الصلاحيات في كل عملية
- منع الوصول غير المصرح به
- تسجيل جميع العمليات

### حماية البيانات
- تشفير البيانات الحساسة
- التحقق من صحة البيانات
- منع هجمات SQL Injection

## الدعم الفني

للحصول على الدعم أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق التطوير.

---

**تاريخ التحديث**: {{ date('Y-m-d') }}
**الإصدار**: 1.0.0
