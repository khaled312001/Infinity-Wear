# نظام الصلاحيات الحقيقي - Infinity Wear

## نظرة عامة

تم إنشاء نظام صلاحيات حقيقي بناء على الصفحات الموجودة في السايد بار لكل نوع مستخدم. النظام يتحقق من الصلاحيات قبل الوصول إلى أي صفحة ويوجه المستخدم إلى لوحة التحكم المناسبة إذا لم يكن لديه صلاحية.

## أنواع المستخدمين والصلاحيات

### 1. الإداريين (Admin)
- **الرئيسية**: لوحة التحكم، الإشعارات، رسائل التواصل، رسائل الواتساب
- **إدارة المحتوى**: إدارة الخدمات، معرض الأعمال، التقييمات
- **إدارة المستوردين**: المستوردين، طلبات المستوردين
- **إدارة المهام**: المهام
- **إدارة المالية**: لوحة المالية، المعاملات المالية، التقارير المالية
- **إدارة الفرق**: فريق التسويق، فريق المبيعات
- **إدارة العملاء**: ملاحظات العملاء
- **إدارة النظام**: التقارير، الإعدادات، الأدوار والصلاحيات، إدارة المديرين، الملف الشخصي

### 2. المستوردين (Importer)
- **الرئيسية**: لوحة التحكم
- **إدارة الطلبات**: طلباتي، تتبع الشحنات، الفواتير
- **إدارة الحساب**: الملف الشخصي، طرق الدفع، الإشعارات
- **الدعم والمساعدة**: المساعدة، الدعم الفني، التواصل معنا

### 3. فريق المبيعات (Sales)
- **الرئيسية**: لوحة التحكم
- **إدارة الطلبات**: طلبات العملاء، طلبات المستوردين
- **إدارة المستوردين**: المستوردين
- **إدارة المهام**: المهام
- **إدارة التواصل**: جهات الاتصال
- **التقارير**: التقارير
- **إدارة الحساب**: الملف الشخصي

### 4. فريق التسويق (Marketing)
- **الرئيسية**: لوحة التحكم
- **إدارة المحتوى**: معرض الأعمال، التقييمات
- **إدارة المهام**: المهام
- **إدارة التواصل**: جهات الاتصال
- **إدارة الحساب**: الملف الشخصي

## الملفات المحدثة

### 1. PermissionController.php
- تم تحديث الصلاحيات لتطابق الصفحات الحقيقية في السايد بار
- تم تحديث الصلاحيات الافتراضية

### 2. CheckUserTypePermission.php (جديد)
- Middleware للتحقق من الصلاحيات
- يتحقق من صلاحية المستخدم قبل الوصول للصفحة
- يوجه المستخدم للوحة التحكم المناسبة إذا لم يكن لديه صلاحية

### 3. UserTypePermissionsSeeder.php (جديد)
- Seeder لإنشاء الصلاحيات الافتراضية
- يتم تشغيله تلقائياً مع DatabaseSeeder

### 4. routes/web.php
- تم إضافة middleware للصلاحيات على جميع الروتات
- كل روت محمي بصلاحية محددة

### 5. bootstrap/app.php
- تم تسجيل middleware الجديد

## كيفية الاستخدام

### 1. تشغيل النظام
```bash
php artisan db:seed --class=UserTypePermissionsSeeder
```

### 2. إدارة الصلاحيات
- انتقل إلى `/admin/permissions`
- يمكنك تعديل الصلاحيات لكل نوع مستخدم
- يمكنك إعادة تعيين الصلاحيات للقيم الافتراضية

### 3. إضافة صلاحية جديدة
1. أضف الصلاحية في `PermissionController.php`
2. أضف middleware للروت في `routes/web.php`
3. حدث الـ seeder إذا لزم الأمر

## قاعدة البيانات

### جدول user_type_permissions
```sql
CREATE TABLE user_type_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_type ENUM('admin', 'importer', 'sales', 'marketing'),
    permission VARCHAR(255),
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    UNIQUE KEY unique_user_permission (user_type, permission),
    INDEX idx_user_type (user_type)
);
```

## الأمان

- جميع الروتات محمية بصلاحيات
- المستخدمون لا يمكنهم الوصول لصفحات غير مصرح لهم بها
- يتم توجيه المستخدمين للوحة التحكم المناسبة مع رسالة خطأ

## التطوير المستقبلي

- إضافة صلاحيات أكثر تفصيلاً
- إضافة نظام أدوار متقدم
- إضافة صلاحيات على مستوى العمليات (إنشاء، تعديل، حذف)
- إضافة نظام تسجيل العمليات

## الدعم

إذا واجهت أي مشاكل في نظام الصلاحيات، يرجى:
1. التحقق من وجود الصلاحيات في قاعدة البيانات
2. التحقق من تسجيل middleware في bootstrap/app.php
3. التحقق من إضافة middleware للروتات
4. التحقق من نوع المستخدم في قاعدة البيانات
