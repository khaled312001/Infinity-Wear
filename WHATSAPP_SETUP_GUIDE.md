# دليل إعداد الواتساب - WhatsApp Setup Guide

## نظرة عامة
تم تكوين النظام لاستخدام الرقم `+966 59 947 6482` كرقم أساسي للواتساب لإرسال واستقبال الرسائل.

## الخطوات المطلوبة لإرسال الرسائل فعلياً

### 1. التسجيل في Whapi.Cloud
- اذهب إلى [https://whapi.cloud](https://whapi.cloud)
- سجل حساب جديد (مجاني للاختبار)
- ستحصل على 5 أيام مجانية للاختبار

### 2. ربط رقم الواتساب
- في لوحة التحكم، ستجد QR Code
- افتح الواتساب على هاتفك
- اذهب إلى: الإعدادات > الأجهزة المرتبطة > ربط جهاز > مسح رمز QR
- امسح الرمز من لوحة التحكم

### 3. الحصول على API Token
- بعد ربط الهاتف، ستجد API Token في لوحة التحكم
- انسخ هذا الرمز

### 4. إضافة الإعدادات في ملف .env
أضف هذه الإعدادات في ملف `.env`:

```env
WHATSAPP_PRIMARY_NUMBER=966599476482
WHATSAPP_API_ENABLED=true
WHATSAPP_API_TOKEN=YOUR_ACTUAL_TOKEN_HERE
WHATSAPP_WEB_ENABLED=true
```

### 5. اختبار النظام
- اذهب إلى: `http://127.0.0.1:8000/admin/whatsapp/test`
- اضغط على "اختبار الاتصال" للتأكد من صحة الإعدادات
- جرب إرسال رسالة تجريبية

## الميزات المتاحة

### إرسال الرسائل
- ✅ إرسال رسائل نصية
- ✅ حفظ الرسائل في قاعدة البيانات
- ✅ تتبع حالة الرسائل (مرسلة، تم التسليم، مقروءة)
- ✅ إرسال فعلي عبر WhatsApp API

### استقبال الرسائل
- ✅ استقبال الرسائل الواردة
- ✅ حفظ الرسائل في قاعدة البيانات
- ✅ تصنيف جهات الاتصال

### إدارة المحادثات
- ✅ عرض جميع المحادثات
- ✅ فلترة الرسائل
- ✅ أرشفة الرسائل
- ✅ حذف الرسائل

## الروابط المهمة

- **لوحة تحكم الواتساب**: `http://127.0.0.1:8000/admin/whatsapp`
- **صفحة الاختبار**: `http://127.0.0.1:8000/admin/whatsapp/test`
- **اختبار الاتصال**: `http://127.0.0.1:8000/admin/whatsapp/test-connection`

## استكشاف الأخطاء

### المشكلة: "API Token غير محدد"
**الحل**: تأكد من إضافة `WHATSAPP_API_TOKEN` في ملف `.env`

### المشكلة: "فشل الاتصال بـ WhatsApp API"
**الحل**: 
1. تأكد من صحة API Token
2. تأكد من ربط رقم الواتساب في Whapi.Cloud
3. تأكد من أن الرقم متصل بالإنترنت

### المشكلة: الرسائل لا تصل
**الحل**:
1. تأكد من صحة رقم المستقبل (مع رمز البلد)
2. تأكد من أن الرقم المستقبل لديه واتساب
3. تحقق من سجلات النظام

## ملاحظات مهمة

1. **الرقم الأساسي**: `+966 59 947 6482` (رقم سعودي)
2. **تنسيق الأرقام**: يجب أن تكون بصيغة دولية (مثال: 966501234567)
3. **الحدود**: Whapi.Cloud يوفر حدود مجانية للاختبار
4. **الأمان**: لا تشارك API Token مع أي شخص

## الدعم

إذا واجهت أي مشاكل:
1. تحقق من سجلات النظام في `storage/logs/laravel.log`
2. استخدم صفحة الاختبار للتشخيص
3. راجع وثائق Whapi.Cloud

---

**تم التطوير بواسطة**: نظام إدارة الواتساب المتقدم
**التاريخ**: يناير 2025