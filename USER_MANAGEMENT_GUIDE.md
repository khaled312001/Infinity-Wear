# دليل نظام إدارة المستخدمين

## نظرة عامة
تم إضافة نظام إدارة المستخدمين الشامل لمنصة Infinity Wear، والذي يتيح للإدارة إضافة وتعديل وحذف المستخدمين بمختلف أنواعهم.

## الميزات الرئيسية

### 1. أنواع المستخدمين المدعومة
- **مدير (admin)**: صلاحيات كاملة على النظام
- **موظف (employee)**: صلاحيات محدودة حسب القسم
- **مستورد (importer)**: وصول إلى صفحة المستوردين وطلباتهم
- **عميل (customer)**: وصول إلى صفحة العملاء
- **مندوب مبيعات (sales)**: وصول إلى صفحة المبيعات
- **موظف تسويق (marketing)**: وصول إلى صفحة التسويق

### 2. الصفحات المتوفرة

#### صفحة قائمة المستخدمين
- **الرابط**: `/admin/users`
- **الوظائف**:
  - عرض جميع المستخدمين مع الفلترة
  - البحث بالاسم، البريد الإلكتروني، أو رقم الهاتف
  - الفلترة حسب نوع المستخدم والحالة
  - إحصائيات شاملة (إجمالي، نشط، غير نشط، حسب النوع)
  - تصدير البيانات إلى CSV

#### صفحة إضافة مستخدم جديد
- **الرابط**: `/admin/users/create`
- **الحقول المطلوبة**:
  - الاسم *
  - البريد الإلكتروني *
  - كلمة المرور *
  - تأكيد كلمة المرور *
  - نوع المستخدم *
  - رقم الهاتف
  - المدينة
  - العنوان
  - الصورة الشخصية
  - نبذة شخصية
  - حالة التفعيل

#### حقول إضافية حسب نوع المستخدم

**للمستوردين**:
- اسم الشركة
- نوع الشركة (فرد/شركة/مؤسسة)
- رقم السجل التجاري

**لفريق التسويق**:
- القسم
- المنصب

**لفريق المبيعات**:
- القسم
- المنصب

#### صفحة تعديل المستخدم
- **الرابط**: `/admin/users/{id}/edit`
- **الوظائف**:
  - تعديل جميع بيانات المستخدم
  - تغيير نوع المستخدم
  - تغيير كلمة المرور (اختياري)
  - رفع صورة شخصية جديدة

#### صفحة تفاصيل المستخدم
- **الرابط**: `/admin/users/{id}`
- **الوظائف**:
  - عرض جميع بيانات المستخدم
  - عرض البيانات الإضافية حسب نوع المستخدم
  - معلومات الحساب (تاريخ الإنشاء، آخر تحديث)
  - إجراءات سريعة (تعديل، تفعيل/إلغاء تفعيل، حذف)

### 3. الإجراءات المتاحة

#### تفعيل/إلغاء تفعيل المستخدم
- يمكن تغيير حالة المستخدم بين نشط وغير نشط
- المستخدمون غير النشطين لا يستطيعون تسجيل الدخول

#### حذف المستخدم
- حذف المستخدم مع جميع بياناته المرتبطة
- حذف الصورة الشخصية تلقائياً
- حذف السجلات المرتبطة (مستورد، تسويق، مبيعات)

#### تصدير البيانات
- تصدير قائمة المستخدمين إلى ملف CSV
- دعم اللغة العربية بشكل كامل
- الفلترة قبل التصدير

## الوصول إلى النظام

### من لوحة التحكم الإدارية
1. تسجيل الدخول كمشرف
2. الذهاب إلى قسم "إدارة العملاء"
3. اختيار "إدارة المستخدمين"

### الصلاحيات المطلوبة
- يجب أن يكون المستخدم مسجل دخول كمشرف (Admin)
- جميع العمليات محمية بصلاحيات الإدارة

## ربط المستوردين

عند إضافة مستخدم جديد من نوع "مستورد":
1. يتم إنشاء سجل في جدول `importers` تلقائياً
2. يظهر المستورد في صفحة المستوردين (`/admin/importers`)
3. يمكن للمستورد تسجيل الدخول والوصول إلى لوحة تحكم المستوردين
4. يمكن عرض تفاصيل المستورد من صفحة المستوردين

## الملفات المضافة/المعدلة

### Controllers
- `app/Http/Controllers/Admin/UserManagementController.php` (جديد)

### Models
- `app/Models/User.php` (تم تحديث العلاقات)

### Views
- `resources/views/admin/users/index.blade.php` (جديد)
- `resources/views/admin/users/create.blade.php` (جديد)
- `resources/views/admin/users/edit.blade.php` (جديد)
- `resources/views/admin/users/show.blade.php` (جديد)

### Routes
- `routes/web.php` (تم إضافة مجموعة routes جديدة)

### Partials
- `resources/views/partials/admin-sidebar.blade.php` (تم إضافة رابط إدارة المستخدمين)

## المميزات التقنية

### الأمان
- تشفير كلمات المرور باستخدام Hash
- التحقق من البيانات المدخلة (Validation)
- حماية الصور المرفوعة (نوع، حجم، امتداد)
- منع تكرار البريد الإلكتروني

### الأداء
- Pagination للقوائم الطويلة
- Eager Loading للعلاقات
- فلترة وبحث محسن
- تخزين الصور في storage مع الوصول العام

### تجربة المستخدم
- واجهة عربية كاملة
- تصميم متجاوب (Responsive)
- رسائل تأكيد للإجراءات الخطرة
- رسائل نجاح وخطأ واضحة
- إحصائيات مرئية وملونة

## الاستخدام المستقبلي

### إضافة مستخدم جديد
```php
POST /admin/users
```

### تحديث مستخدم
```php
PUT /admin/users/{id}
```

### حذف مستخدم
```php
DELETE /admin/users/{id}
```

### تفعيل/إلغاء تفعيل
```php
PATCH /admin/users/{id}/toggle-status
```

### تصدير البيانات
```php
GET /admin/users/export?user_type=importer&status=active
```

## ملاحظات مهمة

1. **المستوردون**: عند إضافة مستخدم من نوع مستورد، يتم إنشاء سجل في جدول `importers` تلقائياً مع حالة `is_verified = false`

2. **فريق التسويق والمبيعات**: يتم إنشاء سجلات في جداول `marketing_team` و `sales_team` تلقائياً

3. **الصور الشخصية**: يتم حفظ الصور في `storage/app/public/avatars` ويجب التأكد من وجود symbolic link

4. **التصدير**: يدعم التصدير الفلترة المسبقة ويصدر البيانات بصيغة CSV مع دعم UTF-8

## الدعم الفني

للمزيد من المعلومات أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق التطوير.

---

**تاريخ الإنشاء**: 2025-10-19  
**الإصدار**: 1.0  
**المطور**: Infinity Wear Development Team
